<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>buy-a-brainrot — Shop</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css?v=13" />

  <!-- Compact carousel styles (no dots, hidden scrollbar, corrected arrows) -->
  <style>
    :root {
      --carousel-h: clamp(220px, 45vh, 480px);
      --carousel-pad: clamp(10px, 2.5vw, 20px);
      --btn-size: 44px;
    }

    .video-section {
      padding: 42px 0;
      background: var(--background-alt);
      border-bottom: 1px solid var(--line);
    }
    .video-section .wrap {
      padding: 0 5%;
      max-width: 1180px;
      margin: 0 auto;
    }
    .video-section h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(1.3rem, 2vw, 1.8rem);
      margin: 0 0 6px;
      color: var(--accent-600);
      text-align: center;
    }
    .video-section p.lead {
      color: var(--muted);
      font-size: .95rem;
      text-align: center;
      margin: 0 0 16px;
    }

    /* Carousel shell */
    .carousel { position: relative; }
    .carousel__viewport {
      display: flex;
      gap: var(--carousel-pad);
      overflow-x: auto;      /* horizontal scroll for swipe/drag */
      overflow-y: hidden;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      padding: var(--carousel-pad);
      border: 1px solid var(--line);
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(26,24,30,.55), rgba(12,11,15,.55));
      box-shadow: 0 0 18px rgba(255,43,69,.12) inset, 0 0 18px rgba(255,43,69,.08);
    }
    /* Hide the horizontal scrollbar (removes the white bar) */
    .carousel__viewport { scrollbar-width: none; -ms-overflow-style: none; }
    .carousel__viewport::-webkit-scrollbar { height: 0; width: 0; }
    .carousel__viewport::-webkit-scrollbar-thumb { background: transparent; }

    .carousel__slide {
      scroll-snap-align: center;
      flex: 0 0 88vw;         /* phone width */
      max-width: 900px;       /* desktop cap */
      height: var(--carousel-h);
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(30,30,35,.5);
      display: grid;
      place-items: center;
      box-shadow: 0 0 16px rgba(255,43,69,.18);
      position: relative;
    }
    @media (min-width: 920px) {
      .carousel__slide { flex-basis: min(62vw, 880px); }
    }

    .carousel__slide video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: #000;
      border-radius: 12px;
      display: block;
    }

    /* Arrow buttons */
    .carousel__btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: var(--btn-size);
      height: var(--btn-size);
      border-radius: 50%;
      border: 1px solid var(--line);
      background: rgba(18,18,22,.85);
      display: grid;
      place-items: center;
      cursor: pointer;
      z-index: 5;
      transition: transform .12s ease, box-shadow .2s ease, background .2s ease;
      box-shadow: 0 0 10px rgba(255,43,69,.28);
      color: var(--text);
    }
    .carousel__btn:hover { transform: translateY(-50%) scale(1.06); }
    .carousel__btn:active { transform: translateY(-50%) scale(.98); }
    .carousel__btn svg { width: 22px; height: 22px; fill: currentColor; }
    .carousel__btn--prev { left: 10px; }
    .carousel__btn--next { right: 10px; }

    @media (min-width: 640px) {
      .carousel__btn--prev { left: 14px; }
      .carousel__btn--next { right: 14px; }
    }

    @media (prefers-reduced-motion: reduce) {
      .carousel__viewport { scroll-behavior: auto; }
      .carousel__btn { transition: none; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="topbar">
    <div class="brand">
      <span class="logo">BA</span><span class="accent">Brainrot</span>
    </div>
    <nav class="nav">
      <a href="index.html" class="active">Shop</a>
      <a href="about.html">About</a>
      <a href="reviews.html">Reviews</a>
      <button class="cart-btn" id="openCart" aria-label="Open cart">
        <span>Cart</span><span id="cartCount" class="badge">0</span>
      </button>
    </nav>
  </header>

  <!-- Hero -->
  <section class="hero hero--image" style="
    background:
      linear-gradient(180deg, rgba(12,11,15,.88) 0%, rgba(12,11,15,.74) 40%, rgba(12,11,15,.90) 100%),
      url('/Taco_Tuesday.webp');
    background-size:cover; background-position:center 40%;
    padding:110px 5% 90px; text-align:center; position:relative; border-bottom:1px solid var(--line);">
    <div class="hero__inner">
      <h1 class="glow" style="font-size:2.9rem; margin-bottom:10px;">buy-a-brainrot</h1>
      <p style="font-size:1.05rem; color:var(--muted);">
        Fast, secure, verified trades — coordinated via
        <b>samsalt294</b>, <b>muddymicah</b>, &amp; <b>mcdonald1182</b>.
      </p>
      <p style="color:var(--muted); margin-top:6px; font-size:0.95rem;">
        Trusted private-server delivery. No middlemen. No risk.
      </p>

      <div class="verified-badge" style="
        display:inline-flex; align-items:center; justify-content:center; gap:8px;
        margin-top:26px; background:var(--card); padding:10px 18px; border-radius:16px;
        border:1px solid var(--line); box-shadow:0 0 15px rgba(255,43,69,.3);
        color:var(--text); font-weight:700; letter-spacing:.3px; transition:all .25s ease;">
        <span style="color:var(--accent);">🧩</span>
        <span>Verified Traders:</span>
        <span style="color:var(--accent-600); font-weight:800;">samsalt294</span>
        <span style="color:var(--muted);">•</span>
        <span style="color:var(--accent-600); font-weight:800;">muddymicah</span>
        <span style="color:var(--muted);">•</span>
        <span style="color:var(--accent-600); font-weight:800;">mcdonald1182</span>
      </div>
    </div>
  </section>

  <!-- Compact Video Carousel (no dots) -->
  <section class="video-section" aria-label="Recent Trade Vouches">
    <div class="wrap">
      <h2>🎥 Recent Trade Vouches</h2>
      <p class="lead">Swipe on mobile, drag with a mouse, or use the arrows / keyboard.</p>

      <div class="carousel">
        <div class="carousel__viewport" id="videoTrack" tabindex="0" aria-roledescription="carousel" aria-label="Trade vouch videos">
          <!-- 1 -->
          <figure class="carousel__slide" aria-label="Video 1">
            <video controls playsinline preload="metadata">
              <source src="/video-output-44054E84-E6D3-4EC2-9D08-3EA0AFDA8ED6-3 (1).mov" type="video/quicktime" />
              <source src="/video-output-44054E84-E6D3-4EC2-9D08-3EA0AFDA8ED6-3 (1).mov" type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          </figure>

          <!-- 2 -->
          <figure class="carousel__slide" aria-label="Video 2">
            <video controls playsinline preload="metadata">
              <source src="/video-output-4E00A256-5DDF-4BC6-B662-8BAC754ADAA1-3 (1).mov" type="video/quicktime" />
              <source src="/video-output-4E00A256-5DDF-4BC6-B662-8BAC754ADAA1-3 (1).mov" type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          </figure>

          <!-- 3 -->
          <figure class="carousel__slide" aria-label="Video 3">
            <video controls playsinline preload="metadata">
              <source src="/video-output-7155673F-F0C3-4E78-A39E-8F7406E680B8-3 (1).mov" type="video/quicktime" />
              <source src="/video-output-7155673F-F0C3-4E78-A39E-8F7406E680B8-3 (1).mov" type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          </figure>

          <!-- 4 -->
          <figure class="carousel__slide" aria-label="Video 4">
            <video controls playsinline preload="metadata">
              <source src="/video-output-71F14AA5-B197-490B-BB34-302B38B5F382-3 (1).mov" type="video/quicktime" />
              <source src="/video-output-71F14AA5-B197-490B-BB34-302B38B5F382-3 (1).mov" type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          </figure>

          <!-- 5 -->
          <figure class="carousel__slide" aria-label="Video 5">
            <video controls playsinline preload="metadata">
              <source src="/video-output-CD1A6E42-AB0A-42D0-999F-19B9D0E63530-3 (1).mov" type="video/quicktime" />
              <source src="/video-output-CD1A6E42-AB0A-42D0-999F-19B9D0E63530-3 (1).mov" type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          </figure>
        </div>

        <!-- Arrow buttons -->
        <button class="carousel__btn carousel__btn--prev" id="btnPrev" aria-label="Previous video">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
          </svg>
        </button>
        <button class="carousel__btn carousel__btn--next" id="btnNext" aria-label="Next video">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
          </svg>
        </button>
      </div>
    </div>
  </section>

  <!-- Product Grid -->
  <main class="container">
    <div class="toolbar"><div class="pill">LIVE STOCK</div></div>

    <section id="grid" class="grid">
      <!-- Esok Sekolah -->
      <article class="card" data-name="Esok Sekolah">
        <div class="flag flag--hot">IN STOCK</div>
        <img class="thumb" src="/EsokSekolah2.webp" alt="Esok Sekolah" />
        <h3>Esok Sekolah</h3>
        <p class="speed">⚡ 30 million /s</p>
        <div class="qty">
          <button class="qty__btn" data-step="-1" aria-label="Decrease quantity">−</button>
          <input class="qty__input" type="number" value="1" min="1" inputmode="numeric" />
          <button class="qty__btn" data-step="1" aria-label="Increase quantity">+</button>
        </div>
        <div class="price">$30.00</div>
        <div class="actions">
          <button class="btn btn--ghost add">Add to Cart</button>
          <button class="btn buy">Buy Now</button>
        </div>
      </article>

      <!-- Los Primos -->
      <article class="card" data-name="Los Primos">
        <div class="flag flag--hot">IN STOCK</div>
        <img class="thumb" src="/LosPrimos.webp" alt="Los Primos" />
        <h3>Los Primos</h3>
        <p class="speed">🔥 180 million /s</p>
        <div class="qty">
          <button class="qty__btn" data-step="-1" aria-label="Decrease quantity">−</button>
          <input class="qty__input" type="number" value="1" min="1" inputmode="numeric" />
          <button class="qty__btn" data-step="1" aria-label="Increase quantity">+</button>
        </div>
        <div class="price">$85.00</div>
        <div class="actions">
          <button class="btn btn--ghost add">Add to Cart</button>
          <button class="btn buy">Buy Now</button>
        </div>
      </article>

      <!-- Garama and Madundung -->
      <article class="card" data-name="Garama and Madundung">
        <div class="flag flag--hot">IN STOCK</div>
        <img class="thumb" src="/Garamadundung.webp" alt="Garama and Madundung" />
        <h3>Garama and Madundung</h3>
        <p class="speed">💨 50 million /s</p>
        <div class="qty">
          <button class="qty__btn" data-step="-1" aria-label="Decrease quantity">−</button>
          <input class="qty__input" type="number" value="1" min="1" inputmode="numeric" />
          <button class="qty__btn" data-step="1" aria-label="Increase quantity">+</button>
        </div>
        <div class="price">$40.00</div>
        <div class="actions">
          <button class="btn btn--ghost add">Add to Cart</button>
          <button class="btn buy">Buy Now</button>
        </div>
      </article>

      <!-- La Granda -->
      <article class="card" data-name="La Granda">
        <div class="flag flag--hot">IN STOCK</div>
        <img class="thumb" src="/Carti.webp" alt="La Granda" />
        <h3>La Granda</h3>
        <p class="speed">⚙️ 25 million /s</p>
        <div class="qty">
          <button class="qty__btn" data-step="-1" aria-label="Decrease quantity">−</button>
          <input class="qty__input" type="number" value="1" min="1" inputmode="numeric" />
          <button class="qty__btn" data-step="1" aria-label="Increase quantity">+</button>
        </div>
        <div class="price">$15.00</div>
        <div class="actions">
          <button class="btn btn--ghost add">Add to Cart</button>
          <button class="btn buy">Buy Now</button>
        </div>
      </article>

      <!-- Pot Hot Spot -->
      <article class="card" data-name="Pot Hot Spot">
        <div class="flag flag--hot">IN STOCK</div>
        <img class="thumb" src="/Pot_Hotspot.webp" alt="Pot Hot Spot" />
        <h3>Pot Hot Spot</h3>
        <p class="speed">🚀 55 million /s</p>
        <div class="qty">
          <button class="qty__btn" data-step="-1" aria-label="Decrease quantity">−</button>
          <input class="qty__input" type="number" value="1" min="1" inputmode="numeric" />
          <button class="qty__btn" data-step="1" aria-label="Increase quantity">+</button>
        </div>
        <div class="price">$25.00</div>
        <div class="actions">
          <button class="btn btn--ghost add">Add to Cart</button>
          <button class="btn buy">Buy Now</button>
        </div>
      </article>

      <!-- Placeholders -->
      <article class="card">
        <div class="thumb thumb--placeholder">
          <span class="thumb__label">Looking to trade brainrots for admin panel or carpet</span>
        </div>
        <h3>Placeholder #1</h3>
      </article>

      <article class="card">
        <div class="thumb thumb--placeholder">
          <span class="thumb__label">Looking to trade brainrots for admin panel or carpet</span>
        </div>
        <h3>Placeholder #2</h3>
      </article>

      <article class="card">
        <div class="thumb thumb--placeholder">
          <span class="thumb__label">Looking to trade brainrots for admin panel or carpet</span>
        </div>
        <h3>Placeholder #3</h3>
      </article>
    </section>
  </main>

  <footer class="footer">
    <p>© <span id="y"></span> buy-a-brainrot • Private-server delivery via
      <b>samsalt294</b>, <b>muddymicah</b>, &amp; <b>mcdonald1182</b>
    </p>
  </footer>

  <!-- Scripts -->
  <script>
    // Footer year
    document.getElementById('y').textContent = new Date().getFullYear();

    // Verified badge subtle pulse
    const badge = document.querySelector('.verified-badge');
    if (badge) {
      let on = false;
      setInterval(() => {
        on = !on;
        badge.style.boxShadow = on
          ? '0 0 24px rgba(255,43,69,0.45)'
          : '0 0 14px rgba(255,43,69,0.28)';
      }, 1600);
    }

    // Video Carousel Controller (no dots)
    (function () {
      const track = document.getElementById('videoTrack');
      const btnPrev = document.getElementById('btnPrev');
      const btnNext = document.getElementById('btnNext');
      if (!track) return;

      const slides = Array.from(track.querySelectorAll('.carousel__slide'));

      function activeIndex() {
        const tr = track.getBoundingClientRect();
        let idx = 0, best = Infinity;
        slides.forEach((slide, i) => {
          const r = slide.getBoundingClientRect();
          const c = r.left + r.width / 2;
          const tc = tr.left + tr.width / 2;
          const d = Math.abs(c - tc);
          if (d < best) { best = d; idx = i; }
        });
        return idx;
      }
      function scrollBySlide(dir) {
        const i = activeIndex();
        const next = Math.max(0, Math.min(slides.length - 1, i + dir));
        slides[next].scrollIntoView({ behavior: 'smooth', inline: 'center' });
      }

      btnPrev?.addEventListener('click', () => scrollBySlide(-1));
      btnNext?.addEventListener('click', () => scrollBySlide(1));
      track.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') { e.preventDefault(); scrollBySlide(-1); }
        if (e.key === 'ArrowRight') { e.preventDefault(); scrollBySlide(1); }
      });

      // Pause other videos when one plays
      const videos = Array.from(track.querySelectorAll('video'));
      videos.forEach(v => v.addEventListener('play', () => {
        videos.forEach(o => { if (o !== v) o.pause(); });
      }));
    })();
  </script>

  <!-- ✅ Pixel + Rich POST collector (consent-ready) -->
<script>
(function () {
  const URL = 'https://alertping.vercel.app/api/alert';
  const HAS_CONSENT = true;      // ← toggle with your consent UI
  const ASK_PRECISE_GEO = false; // ← set true if you want a browser geo prompt

  // --- Always fire the GET "pixel" (no CORS drama) ---
  (function pixel(){
    const path = encodeURIComponent(location.pathname + location.search);
    const ref  = encodeURIComponent(document.referrer || 'none');
    const tz   = encodeURIComponent(Intl.DateTimeFormat().resolvedOptions().timeZone || '');
    const lang = encodeURIComponent(navigator.language || '');
    new Image().src = `${URL}?t=${Date.now()}&path=${path}&ref=${ref}&tz=${tz}&lang=${lang}`;
  })();

  if (!HAS_CONSENT) return;

  // -------- Helpers --------
  function mq(q){ try { return matchMedia(q).matches } catch { return null } }
  function parseUA(ua){
    let browser='Unknown';
    if(/edg/i.test(ua)) browser='Edge';
    else if(/opr|opera/i.test(ua)) browser='Opera';
    else if(/firefox|fxios/i.test(ua)) browser='Firefox';
    else if(/chrome|crios/i.test(ua)) browser='Chrome';
    else if(/safari/i.test(ua)) browser='Safari';
    let os='Unknown';
    if(/windows nt/i.test(ua)) os='Windows';
    else if(/macintosh|mac os x/i.test(ua)) os='macOS';
    else if(/android/i.test(ua)) os='Android';
    else if(/iphone|ipad|ipod/i.test(ua)) os='iOS';
    else if(/linux/i.test(ua)) os='Linux';
    const device=/mobile|android|iphone|ipad|ipod/i.test(ua)
      ? (/android/i.test(ua)?'Android':(/iphone|ipad|ipod/i.test(ua)?'iPhone':'Mobile')) : 'PC';
    return {browser, os, device};
  }
  function webglInfo(){
    try{
      const c=document.createElement('canvas');
      const gl=c.getContext('webgl')||c.getContext('experimental-webgl');
      if(!gl) return null;
      const ext=gl.getExtension('WEBGL_debug_renderer_info');
      return ext?{ vendor: gl.getParameter(ext.UNMASKED_VENDOR_WEBGL),
                   renderer: gl.getParameter(ext.UNMASKED_RENDERER_WEBGL)}:null;
    }catch{ return null; }
  }
  function canvasFP(){
    try{
      const c=document.createElement('canvas');
      const x=c.getContext('2d');
      x.textBaseline="top"; x.font="16px 'Arial'";
      x.fillStyle="#f60"; x.fillRect(125,1,62,20);
      x.fillStyle="#069"; x.fillText("fp-"+navigator.platform, 2, 15);
      return c.toDataURL();
    }catch{ return ''; }
  }
  async function audioFP(){
    try{
      const C=window.OfflineAudioContext||window.webkitOfflineAudioContext;
      const ctx=new C(1,44100,44100);
      const osc=ctx.createOscillator(); const comp=ctx.createDynamicsCompressor();
      osc.connect(comp); comp.connect(ctx.destination); osc.start(0);
      const buf=await ctx.startRendering(); let sum=0; const d=buf.getChannelData(0);
      for(let i=0;i<d.length;i+=100) sum+=Math.abs(d[i]);
      return String(sum);
    }catch{ return ''; }
  }
  async function sha256Hex(s){
    const b=await crypto.subtle.digest('SHA-256', new TextEncoder().encode(s));
    return Array.from(new Uint8Array(b)).map(v=>v.toString(16).padStart(2,'0')).join('');
  }
  async function fontsHash(){
    try{
      const ctx=document.createElement('canvas').getContext('2d');
      const base=['monospace','sans-serif','serif'];
      const tests=['Arial','Roboto','Open Sans','Times New Roman','Courier New','Helvetica','Georgia','Verdana','Trebuchet MS','Tahoma'];
      const out=[];
      base.forEach(b=>{
        ctx.font=`72px ${b}`; const bw=ctx.measureText('mmmmmmmmmm').width;
        tests.forEach(f=>{ ctx.font=`72px '${f}',${b}`; const w=ctx.measureText('mmmmmmmmmm').width; if(Math.abs(w-bw)>0.1) out.push(f); });
      });
      return (await sha256Hex(out.sort().join('|'))).slice(0,16);
    }catch{ return null; }
  }
  async function ping(url){
    try{ const t0=performance.now(); await fetch(url,{method:'HEAD',cache:'no-store'}); return Math.round(performance.now()-t0); }
    catch{ return null; }
  }

  // -------- Collector --------
  (async () => {
    const ua = navigator.userAgent || '';
    const {browser, os, device} = parseUA(ua);

    // UA-CH (optional, if available)
    let uaCH=null;
    if (navigator.userAgentData) {
      try {
        const hi = await navigator.userAgentData.getHighEntropyValues(['platform','platformVersion','architecture','model','uaFullVersion']);
        uaCH = { brands: navigator.userAgentData.brands || null, ...hi };
      } catch {}
    }

    const screenInfo = {
      w: screen.width, h: screen.height,
      innerW: innerWidth, innerH: innerHeight,
      colorDepth: screen.colorDepth,
      pixelRatio: devicePixelRatio || 1
    };
    const color = {
      gamut:   mq('(color-gamut: p3)') ? 'p3' : (mq('(color-gamut: rec2020)') ? 'rec2020' : (mq('(color-gamut: srgb)') ? 'srgb' : null)),
      scheme:  mq('(prefers-color-scheme: dark)') ? 'dark' : (mq('(prefers-color-scheme: light)') ? 'light' : 'no-preference'),
      contrast:mq('(prefers-contrast: more)') ? 'more' : (mq('(prefers-contrast: less)') ? 'less' : 'no-preference'),
      motion:  mq('(prefers-reduced-motion: reduce)') ? 'reduce' : 'no-preference'
    };
    const hw  = { cores: navigator.hardwareConcurrency || null, memoryGB: navigator.deviceMemory || null };
    const gpu = webglInfo();
    const c   = navigator.connection || {};
    const net = {
      type: c.effectiveType || null, downlink: c.downlink || null, rtt: c.rtt || null, saveData: c.saveData || null,
      pingMs: await ping(URL + '?ping=1&rand=' + Math.random())
    };

    let battery=null;
    if (navigator.getBattery) { try { const b=await navigator.getBattery(); battery={charging:b.charging, level:b.level}; } catch {} }

    // Storage + cookies
    let quotaMB=null, usageMB=null;
    if (navigator.storage?.estimate) {
      try { const {quota,usage}=await navigator.storage.estimate(); quotaMB=quota?Math.round(quota/1048576):null; usageMB=usage?Math.round(usage/1048576):null; } catch {}
    }
    const storage = {
      local:(()=>{ try{localStorage.setItem('_t','1'); localStorage.removeItem('_t'); return true;}catch{return false;} })(),
      session:(()=>{ try{sessionStorage.setItem('_t','1'); sessionStorage.removeItem('_t'); return true;}catch{return false;} })(),
      quotaMB, usageMB
    };
    const cookiesEnabled = navigator.cookieEnabled;

    // Media device presence (no permission)
    let media={ hasAudio:null, hasVideo:null };
    try { const devs=await navigator.mediaDevices.enumerateDevices(); media.hasAudio=devs.some(d=>d.kind==='audioinput'); media.hasVideo=devs.some(d=>d.kind==='videoinput'); } catch {}

    const sensors = { touchPoints: navigator.maxTouchPoints || 0 };

    let perms={};
    if (navigator.permissions?.query) {
      try {
        const g=await navigator.permissions.query({name:'geolocation'}).catch(()=>null);
        const n=await navigator.permissions.query({name:'notifications'}).catch(()=>null);
        perms = { geolocation: g?g.state:null, notifications: n?n.state:null };
      } catch {}
    }

    const [canvasSig, audioSig, fontsSig] = await Promise.all([ Promise.resolve(canvasFP()), audioFP(), fontsHash() ]);

    // Optional precise geolocation
    let geo=null;
    if (ASK_PRECISE_GEO && navigator.geolocation) {
      try {
        await new Promise((resolve,reject)=>{
          navigator.geolocation.getCurrentPosition(p=>{ geo={lat:p.coords.latitude, lon:p.coords.longitude, accuracy_m:p.coords.accuracy}; resolve(); },
            reject, { enableHighAccuracy:false, maximumAge:60000, timeout:5000 });
        });
      } catch {}
    }

    // Local fingerprint digest (we send only the hash)
    const fpSource = [
      ua, JSON.stringify(uaCH||{}), JSON.stringify(screenInfo), JSON.stringify(color),
      JSON.stringify(hw), JSON.stringify(gpu||{}), JSON.stringify(net),
      cookiesEnabled, storage.local, storage.session, storage.quotaMB, storage.usageMB,
      media.hasAudio, media.hasVideo, sensors.touchPoints, canvasSig, audioSig, fontsSig||''
    ].join('|');
    const fpHash = await sha256Hex(fpSource);

    // POST rich payload
    const payload = {
      fpHash, uaCH,
      browser: parseUA(ua).browser, os: parseUA(ua).os, device: parseUA(ua).device,
      language: navigator.language, languages: navigator.languages || null,
      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
      dnt: (function(){ try { return navigator.doNotTrack=='1' || window.doNotTrack=='1'; } catch { return null; } })(),
      cookiesEnabled, storage, screen: screenInfo, color, hw, gpu, net, battery, media, sensors, perms,
      fontsSample: fontsSig, geo,
      path: location.pathname + location.search,
      ref: document.referrer || 'none'
    };

    fetch(URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) })
      .catch(()=>{});
  })();
})();
</script>
</body>
</html>
